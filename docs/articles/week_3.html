<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="datascience.curriculum">
<title>Week 3:  Next Level R • datascience.curriculum</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Week 3:  Next Level R">
<meta property="og:description" content="datascience.curriculum">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">datascience.curriculum</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9008</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/week_1.html">Week 1:  Setting Up</a>
    <a class="dropdown-item" href="../articles/week_2.html">Week 2:  R Fundamentals</a>
    <a class="dropdown-item" href="../articles/week_3.html">Week 3:  Next Level R</a>
    <a class="dropdown-item" href="../articles/week_6.html">Week 6:  Packages</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Week 3:  Next Level R</h1>
            
      
      
      <div class="d-none name"><code>week_3.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This lecture introduces more advanced concepts in R. You should have
some level of comfort with the basic data types and structures and how
to assign values to variables. Here we will learn ways in which R can
automate complex or repetitive tasks in a way that is
error-resistant.</p>
</div>
<div class="section level2">
<h2 id="scope">Scope<a class="anchor" aria-label="anchor" href="#scope"></a>
</h2>
<p>Scope is a concept in computer science that has to do with how the
names and values of variables relate to each other. It refers to the
part of a program where the name of a variable representing a piece of
data or a function is valid.</p>
<p>If you have a function or piece of data in your global environment
with the same name as a different function or piece of data in a certain
package, R will have to decide which you are referring to when you put
that name in your code. In this case, the global environment takes
priority.</p>
<p>But let’s say early in an analysis script I choose to represent a
piece of data with the variable name <code>x</code>. This is probably
not a wise choice, since <code>x</code> is a commonly used name. Maybe
later in the script I represent a different piece of data with the the
variable name <code>x</code>. This overwrites the old version because
they were created with the same scope, i.e. the global environment.
Finally when I want to use <code>x</code> I could make an error because
I didn’t realize that I had referred to it twice in my analysis
script.</p>
<p>There are ways to protect against this:</p>
<ul>
<li>use pipes to avoid saving intermediate values (see previous
lecture)</li>
<li>use unique and informative variable names for the things you must
save</li>
<li>use functional programming techniques (this lecture)</li>
<li>package processed data (subsequent lecture)</li>
</ul>
<p>In R by default, functions have their own scope, meaning they create
their own special transient environment to store names and values of
variables which does not affect the global environment. These values can
be passed in as arguments to the function or can be created internally.
When the function is complete, this environment goes away. The function
environment is the highest priority environment for that function and
therefore is the first place R looks for values. If the value of a
variable in the body of the function isn’t found it goes up a level in
scope, which is usually the global environment (or to the environment of
an enclosing function). This behavior is error-prone and we should try
to avoid it.</p>
<p>By specifying all of the external variables your function needs as
arguments, you force the function to stay within its own scope which is
a safer way to go.</p>
<p>Using functional programming practices like this is a safe way to
prevent unrecognized errors in your analysis code.</p>
</div>
<div class="section level2">
<h2 id="writing-custom-functions">Writing custom functions<a class="anchor" aria-label="anchor" href="#writing-custom-functions"></a>
</h2>
<p>Functions are expressions of code that usually take input values and
return output values. Output is returned to the console or can be
assigned to a new variable. Functions have names and can behave much
like other objects in R. They can be operated on by other functions as
we will see later. Functions can also have side effects, meaning they
can produce graphics or write files which are separate from their main
outputs.</p>
<p>Here is the syntax you must use when writing functions in R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simple function to add two numbers</span></span>
<span><span class="va">function_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">argument_1</span>, <span class="va">argument_2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">argument_1</span> <span class="op">+</span> <span class="va">argument_2</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">function_name</span><span class="op">(</span>argument_1 <span class="op">=</span> <span class="fl">1</span>, argument_2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>These names are for demonstration only; you should always pick names
that are explicit and clear.</p>
<p>There are syntactic shortcuts you can make when writing and calling
functions, but this is the clearest and best way to go.</p>
<p>In order to demonstrate the concept of scope from the previous
section, see this example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># both arguments will be contained within the function's scope</span></span>
<span><span class="va">good_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">addend_1</span>, <span class="va">addend_2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">addend_1</span> <span class="op">+</span> <span class="va">addend_2</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">good_sum</span><span class="op">(</span>addend_1 <span class="op">=</span> <span class="fl">1</span>, addend_2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 3</span></span>
<span></span>
<span><span class="co"># addend_1 provided in the global environment which is inherited by the function</span></span>
<span><span class="va">bad_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">addend_2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">addend_1</span> <span class="op">+</span> <span class="va">addend_2</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">addend_1</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="fu">bad_sum</span><span class="op">(</span>addend_2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span></span>
<span><span class="co"># the function's scope supersedes the global environment</span></span>
<span><span class="fu">good_sum</span><span class="op">(</span>addend_1 <span class="op">=</span> <span class="fl">3</span>, addend_2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>You always want to explicitly pass arguments into functions and
explicitly return results as shown in <code>good_sum</code>.</p>
<p>By design, functions can return only a single value (although they
can produce any number of side effects). This is OK because if you
wanted to return more than one object, all you have to do is put them in
a list and return the list:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">two_averages</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># calculate the mean and median</span></span>
<span>  <span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="co"># put all of the results we want into a list</span></span>
<span>  <span class="va">return_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">median</span><span class="op">)</span></span>
<span>  <span class="co"># optionally provide names to the list elements so we know exactly what they are</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">return_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"the_mean"</span>, <span class="st">"the_median"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">return_list</span><span class="op">)</span></span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="fu">two_averages</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $the_mean</span></span>
<span><span class="co">#&gt; [1] 3.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $the_median</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>You don’t have to provide names for your return list but in many
cases it is helpful. You can notice here that I used <code>x</code> to
represent the argument of the function. Since this is a private variable
only used within the scope of the function I am free to do this any time
I want in the context of my global environment.</p>
</div>
<div class="section level2">
<h2 id="conditionals">Conditionals<a class="anchor" aria-label="anchor" href="#conditionals"></a>
</h2>
<p>Conditional statements (if/then/else) are particularly useful inside
your custom functions. Use them to provide logic to your function or to
catch errors.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unsafe_divide</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">/</span><span class="va">y</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># returns Infinity which is not a useful value</span></span>
<span><span class="fu">unsafe_divide</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Inf</span></span>
<span></span>
<span><span class="va">safe_divide</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="st">"You can't divide by 0"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">/</span><span class="va">y</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">safe_divide</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "You can't divide by 0"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mapapply">Map/Apply<a class="anchor" aria-label="anchor" href="#mapapply"></a>
</h2>
<p>You should never repeat yourself when performing an analysis.
Copy/pasting code is error prone. It is better to encode a method for
the computer to do the repetition.</p>
<p>There are a few mechanisms to do this. You may be familiar with <a href="https://www.statmethods.net/management/controlstructures.html" class="external-link">for
loops</a>. We won’t be discussing these because they have a number of
disadvantages, one of which is that they tend to operate in the global
environment which can cause scope issues as discussed above.</p>
<p>The best mechanism for doing an iterative procedure is to use the
“map” paradigm. I prefer to use the tidyverse implementation here, from
the <a href="https://purrr.tidyverse.org/" class="external-link">purrr package</a>.</p>
<p>You provide a vector or list of values that you want to iteratively
apply a function to. There are syntactic shortcuts which are confusing
and should generally be avoided, so even for simple examples I write
them like this.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># attach the packages we will need</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># return the results in the form of a list</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span></span>
<span><span class="co"># return a numeric vector instead</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2 3 4</span></span>
<span></span>
<span></span>
<span><span class="co"># map along two vectors</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  .y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"The first result is "</span>,</span>
<span>         <span class="st">"The second result is "</span>,</span>
<span>         <span class="st">"The final result is "</span><span class="op">)</span>,</span>
<span>  .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "The first result is 2"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "The second result is 3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] "The final result is 4"</span></span>
<span></span>
<span><span class="co"># map along an arbitrary number of lists or vectors</span></span>
<span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span></span>
<span>  .l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    begin_text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"The first result is "</span>,</span>
<span>          <span class="st">"The second result is "</span>,</span>
<span>          <span class="st">"The final result is "</span><span class="op">)</span>,</span>
<span>    end_text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" apples"</span>, <span class="st">" bananas"</span>, <span class="st">" cherries"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">begin_text</span>, <span class="va">end_text</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">begin_text</span>, <span class="va">result</span>, <span class="va">end_text</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "The first result is 2 apples"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "The second result is 3 bananas"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] "The final result is 4 cherries"</span></span></code></pre></div>
<p>The first of these examples is much more easily (and quickly)
accomplished with vectorized math. But as you can see, things can get
more complicated and at some point you may want to write a custom
function to create the output you want.</p>
<p>The map family has a number of variants that return the result in the
form of vectors or dataframes, depending on what the output is.</p>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<p>Plotting results is a major feature of what we do in the sciences.
There are principles for effective visual representation of <a href="https://www.edwardtufte.com/tufte/books_vdqi" class="external-link">data</a>. There are
many <a href="https://r-graphics.org/" class="external-link">resources</a> for you to use for
effectively presenting your data in R. Generally though you will want to
start by making graphics look like they look in a high-quality
publication. Google is your best way to find out how to make any plot in
R.</p>
<p>You may be able to get comparable results with an interactive program
like GraphPad or Excel. R will let you work in a programmatic way
(letting the computer do the work for you), with greater control, and
better aesthetics. Eventually you will be able to make more
sophisticated graphics not possible in other programs.</p>
<p>The purpose of this lecture is not to tell you what is aesthetically
best but rather to teach you how to control the aesthetics of the plots
you are making to suit your own circumstances.</p>
</div>
<div class="section level2">
<h2 id="plot-framework">Plot framework<a class="anchor" aria-label="anchor" href="#plot-framework"></a>
</h2>
<p>The program we use for plotting most data in R is ggplot2. You start
with ggplot by providing data and mapping dimensions of your data to
aesthetics. This generates a “framework” for your plot to which you add
layers. Each layer adds or changes the visual output of the plot.</p>
<p>In this context, one aesthetic is used to describe one dimension of
your data. Common aesthetics include x and y which represent the
position in space on a plot. Others include color, fill, size, shape,
alpha (transparency) and label (a text label), all of which can be used
to describe dimensions of your data.</p>
<p>As a simple example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example data</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 150 × 5</span></span></span>
<span><span class="co">#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt;           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          5.1         3.5          1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>          4.9         3            1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>          4.7         3.2          1.3         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>          4.6         3.1          1.5         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>          5           3.6          1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          5.4         3.9          1.7         0.4 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>          4.6         3.4          1.4         0.3 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>          5           3.4          1.5         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          4.4         2.9          1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>          4.9         3.1          1.5         0.1 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 140 more rows</span></span></span>
<span></span>
<span><span class="co"># make the plot framework</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="week_3_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>So we have the framework. X and Y are correctly mapped to the
dimensions of our data, but we haven’t told ggplot how to display
it.</p>
<p>Graphical elements are called geoms:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add a basic geom</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="week_3_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Jitter is a nice geom to use because it reduces overplotting.</p>
<p>Although not necessary for this plot in isolation, maybe you want to
have each Species depicted with a different color to align with a
graphical theme in your figure.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="va">Species</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="week_3_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>For most journals you want to show a measure of central tendency and
variation like mean +/- sem.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="va">Species</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">mean_se</span>, </span>
<span>               geom <span class="op">=</span> <span class="st">"crossbar"</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>               alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="week_3_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Often we want those nice p value indicators. This is tedious to add
in R directly so we use a helper function from the ggpubr package:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="va">Species</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">mean_se</span>, </span>
<span>               geom <span class="op">=</span> <span class="st">"crossbar"</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>               alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_compare_means.html" class="external-link">stat_compare_means</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"t.test"</span>, </span>
<span>                     label <span class="op">=</span> <span class="st">"p.signif"</span>,</span>
<span>                     comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"versicolor"</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"versicolor"</span>, <span class="st">"virginica"</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"virginica"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="week_3_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>We can change the default colors using custom scales:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="va">Species</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">mean_se</span>, </span>
<span>               geom <span class="op">=</span> <span class="st">"crossbar"</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>               alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_compare_means.html" class="external-link">stat_compare_means</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"t.test"</span>, </span>
<span>                     label <span class="op">=</span> <span class="st">"p.signif"</span>,</span>
<span>                     comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"versicolor"</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"versicolor"</span>, <span class="st">"virginica"</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"virginica"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span>, aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="week_3_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>You can look up some nice, visually distinct color palettes using <a href="https://www.r-graph-gallery.com/38-rcolorbrewers-palettes.html" class="external-link">color
brewer</a>.</p>
<p>You can also set your own custom scales:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="va">Species</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">mean_se</span>, </span>
<span>               geom <span class="op">=</span> <span class="st">"crossbar"</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>               alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_compare_means.html" class="external-link">stat_compare_means</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"t.test"</span>, </span>
<span>                     label <span class="op">=</span> <span class="st">"p.signif"</span>,</span>
<span>                     comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"versicolor"</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"versicolor"</span>, <span class="st">"virginica"</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"virginica"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span> <span class="op">=</span> <span class="st">"red3"</span>, </span>
<span>                               <span class="st">"versicolor"</span> <span class="op">=</span> <span class="st">"green4"</span>, </span>
<span>                               <span class="st">"virginica"</span> <span class="op">=</span> <span class="st">"blue3"</span><span class="op">)</span>, </span>
<span>                    aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="week_3_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Finally you can change the look of the axes, labels and legends.
There are many different lines of code you can use to do this, most of
which start with <code><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme()</a></code>. I usually prefer to start with a
preset theme which looks nice for almost all plots. We can also get rid
of the legend which doesn’t help much in this case:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="va">Species</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">mean_se</span>, </span>
<span>               geom <span class="op">=</span> <span class="st">"crossbar"</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>               alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_compare_means.html" class="external-link">stat_compare_means</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"t.test"</span>, </span>
<span>                     label <span class="op">=</span> <span class="st">"p.signif"</span>,</span>
<span>                     comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"versicolor"</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"versicolor"</span>, <span class="st">"virginica"</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"virginica"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"setosa"</span> <span class="op">=</span> <span class="st">"red3"</span>, </span>
<span>                               <span class="st">"versicolor"</span> <span class="op">=</span> <span class="st">"green4"</span>, </span>
<span>                               <span class="st">"virginica"</span> <span class="op">=</span> <span class="st">"blue3"</span><span class="op">)</span>, </span>
<span>                    aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="week_3_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Keeping your plot functions organized in this way is a good idea so
you can quickly go back and change things when necessary.</p>
</div>
<div class="section level2">
<h2 id="basic-statistical-testing">Basic statistical testing<a class="anchor" aria-label="anchor" href="#basic-statistical-testing"></a>
</h2>
<p>This is not a biostatistics course, but you will probably want to
know how to perform things like t-tests and wilcox tests on your
data.</p>
<p>R can perform a large number of statistical tests with base
functions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span>x  <span class="op">=</span> <span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="va">iris</span> <span class="op">|&gt;</span></span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"versicolor"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span>, </span>
<span>       var.equal <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  pull(filter(iris, Species == "setosa"), Sepal.Length) and pull(filter(iris, Species == "versicolor"), Sepal.Length)</span></span>
<span><span class="co">#&gt; t = -10.521, df = 86.538, p-value &lt; 2.2e-16</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  -1.1057074 -0.7542926</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean of x mean of y </span></span>
<span><span class="co">#&gt;     5.006     5.936</span></span></code></pre></div>
<p>What is happening here is that we are filtering the dataset twice
(once for each group we want to compare) and then pulling the value from
the resulting dataframe as a numerical vector. This is fed into the
t.test function.</p>
<p>For me, the base function above is painful both to type and to read.
You may wish to use a more concise method:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/rstatix/" class="external-link">rstatix</a></span><span class="op">)</span></span>
<span><span class="co"># print out a table of descriptive values</span></span>
<span><span class="va">iris</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/rstatix/reference/get_summary_stats.html" class="external-link">get_summary_stats</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 14</span></span></span>
<span><span class="co">#&gt;    Species  varia…¹     n   min   max median    q1    q3   iqr   mad  mean    sd</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> setosa   Sepal.…    50   4.3   5.8   5     4.8   5.2  0.4   0.297 5.01  0.352</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> setosa   Sepal.…    50   2.3   4.4   3.4   3.2   3.68 0.475 0.371 3.43  0.379</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> setosa   Petal.…    50   1     1.9   1.5   1.4   1.58 0.175 0.148 1.46  0.174</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> setosa   Petal.…    50   0.1   0.6   0.2   0.2   0.3  0.1   0     0.246 0.105</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> versico… Sepal.…    50   4.9   7     5.9   5.6   6.3  0.7   0.519 5.94  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> versico… Sepal.…    50   2     3.4   2.8   2.52  3    0.475 0.297 2.77  0.314</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> versico… Petal.…    50   3     5.1   4.35  4     4.6  0.6   0.519 4.26  0.47 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> versico… Petal.…    50   1     1.8   1.3   1.2   1.5  0.3   0.222 1.33  0.198</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> virgini… Sepal.…    50   4.9   7.9   6.5   6.22  6.9  0.675 0.593 6.59  0.636</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> virgini… Sepal.…    50   2.2   3.8   3     2.8   3.18 0.375 0.297 2.97  0.322</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> virgini… Petal.…    50   4.5   6.9   5.55  5.1   5.88 0.775 0.667 5.55  0.552</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> virgini… Petal.…    50   1.4   2.5   2     1.8   2.3  0.5   0.297 2.03  0.275</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 2 more variables: se &lt;dbl&gt;, ci &lt;dbl&gt;, and abbreviated variable name</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ¹​variable</span></span></span>
<span></span>
<span><span class="co"># do the t-test</span></span>
<span><span class="va">iris</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/rstatix/reference/t_test.html" class="external-link">t_test</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Species</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 10</span></span></span>
<span><span class="co">#&gt;   .y.          group1 group2    n1    n2 stati…¹    df        p    p.adj p.adj…²</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Sepal.Length setosa versi…    50    50  -<span style="color: #BB0000;">10.5</span>   86.5 3.75<span style="color: #949494;">e</span><span style="color: #BB0000;">-17</span> 7.5 <span style="color: #949494;">e</span><span style="color: #BB0000;">-17</span> ****   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Sepal.Length setosa virgi…    50    50  -<span style="color: #BB0000;">15.4</span>   76.5 3.97<span style="color: #949494;">e</span><span style="color: #BB0000;">-25</span> 1.19<span style="color: #949494;">e</span><span style="color: #BB0000;">-24</span> ****   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Sepal.Length versi… virgi…    50    50   -<span style="color: #BB0000;">5.63</span>  94.0 1.87<span style="color: #949494;">e</span><span style="color: #BB0000;">- 7</span> 1.87<span style="color: #949494;">e</span><span style="color: #BB0000;">- 7</span> ****   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​statistic, ²​p.adj.signif</span></span></span></code></pre></div>
<p>rstatix is a useful package for extending the base statistical
functions of R.</p>
</div>
<div class="section level2">
<h2 id="exercises">Exercises<a class="anchor" aria-label="anchor" href="#exercises"></a>
</h2>
<ul>
<li>practice writing your own simple functions</li>
<li>read in data from your own work, plot it with ggplot and perform
statistical testing. Try using some different geoms:
<code><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col()</a></code> are the most
useful.</li>
<li>use <code><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">readr::write_csv()</a></code> to write out a table of
statistical results and <code><a href="https://wilkelab.org/cowplot/reference/save_plot.html" class="external-link">cowplot::save_plot()</a></code> to save your
plot</li>
<li>use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> to apply a function iteratively</li>
<li>Extra credit: use <code><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">cowplot::plot_grid()</a></code> to compose
multiple plots into a figure</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brad Blaser.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
